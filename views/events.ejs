<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Events</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <!-- <link rel="stylesheet" href="./css/patientEventPage.css"> -->
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f2f5;
        }

        /* Navbar */
.navbar {
    padding: 1.5rem 2rem;
    background: linear-gradient(90deg, #0d0d0d, #333333); /* Sleeker dark gradient */
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); /* Stronger shadow for modernity */
    font-family: 'Poppins', sans-serif;
    transition: background-color 0.3s ease-in-out; /* Smooth transition on hover */
}

.navbar:hover {
    background: linear-gradient(90deg, #141414, #4c4c4c); /* Darker on hover */
}

.navbar-brand {
    color: #ffc107;
    font-weight: 800;
    font-size: 2.2rem;
    letter-spacing: 0.08rem;
    text-transform: uppercase;
}

.nav-link {
    color: #ffffff;
    margin-right: 1.5rem;
    font-size: 1.1rem;
    font-weight: 500;
    transition: color 0.4s ease;
}

.nav-link:hover {
    color: #ffc107; /* Golden hover effect */
}

.navbar-toggler {
    border-color: #ffc107;
}

/* Dropdown menu */
.dropdown-menu {
    background-color: #212529;
    border: none;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); /* Elevated dropdown */
}

.dropdown-item {
    color: #ffffff;
    padding: 0.9rem 1.5rem;
    transition: background-color 0.3s ease;
}

.dropdown-item:hover {
    background-color: #ffc107;
}
        /* Flip Card Design */
.flip-card {
    perspective: 1200px;
    margin: 25px 0;
    transition: transform 0.6s ease-in-out;
    border-radius: 15px;
    position: relative;
    overflow: hidden;
    height: 350px;
    background-color: #f8f9fa;
    box-shadow: 0 12px 25px rgba(0, 0, 0, 0.1);
    cursor: pointer;
}

.flip-card-inner {
    position: relative;
    width: 100%;
    height: 100%;
    transition: transform 0.7s ease-in-out;
    transform-style: preserve-3d;
}

.flip-card-front,
.flip-card-back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 15px;
}

.flip-card-front {
    background-color: #ffffff;
    color: #212529;
    padding: 35px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.05);
}

.flip-card-back {
    background-color: #495057;
    color: #f8f9fa;
    padding: 35px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    transform: rotateY(180deg);
}

.flip-card.flipped .flip-card-inner {
    transform: rotateY(180deg);
}

/* Card Title */
.card-title {
    font-weight: 700;
    margin-bottom: 15px;
    color: #343a40;
    font-size: 1.25rem;
}

.flip-card-back .card-title {
    color: #ffc107;
}

/* Card Text */
.card-text {
    font-size: 1.1rem;
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
}

.label {
    font-weight: 500;
    color: #6c757d;
}

.value {
    font-weight: 600;
    color: #212529;
}

.flip-card-back .value {
    color: #f8f9fa;
}

/* Click Indicator */
.click-indicator {
    font-size: 0.9rem;
    text-align: center;
    color: #6c757d;
    margin-top: 15px;
    font-style: italic;
}

.click-indicator i {
    margin-left: 5px;
}

/* Section Titles */
.section-title {
    text-align: center;
    margin-bottom: 40px;
    font-weight: 700;
    font-size: 2.25rem;
    color: #343a40;
    letter-spacing: 0.05rem;
    text-transform: uppercase;
}

/* Book Button */
.btn-book {
    background-color: #343a40;
    color: white;
    margin-top: 25px;
    padding: 12px 25px;
    border-radius: 30px;
    font-weight: 600;
    transition: background-color 0.3s ease, transform 0.2s ease;
}

.btn-book:hover {
    background-color: #495057;
    transform: translateY(-3px);
    color: #f8f9fa;
}

/* Modal Styling */
.modal {
    display: none;
    position: fixed;
    z-index: 1050;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6);
    justify-content: center;
    align-items: center;
    transition: opacity 0.3s ease;
}

.modal-content {
    background-color: white;
    padding: 25px;
    border-radius: 15px;
    width: 350px;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
}

.modal h3 {
    color: #212529;
    font-size: 1.75rem;
    margin-bottom: 20px;
}

.modal p {
    color: #555;
    font-size: 1.1rem;
    margin-bottom: 25px;
}

.close-btn {
    color: #999;
    float: right;
    font-size: 26px;
    cursor: pointer;
}

.close-btn:hover {
    color: #333;
}

/* Modal Buttons */
.modal-buttons {
    display: flex;
    justify-content: space-between;
    margin-top: 25px;
}

.btn-confirm, .btn-cancel {
    padding: 12px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1.1rem;
    font-weight: 600;
    transition: background-color 0.3s ease;
}

.btn-confirm {
    background-color: #28a745;
    color: white;
}

.btn-confirm:hover {
    background-color: #218838;
}

.btn-cancel {
    background-color: #dc3545;
    color: white;
}

.btn-cancel:hover {
    background-color: #c82333;
}

/* Responsiveness */
@media (max-width: 768px) {
    .flip-card {
        margin-bottom: 25px;
        height: 280px;
    }

    .section-title {
        font-size: 1.75rem;
    }

    .modal-content {
        width: 90%;
        padding: 20px;
    }

    .card-title {
        font-size: 1.2rem;
    }
}

    </style>
</head>

<body>

    <!-- Navbar (Your Existing Navbar will be included) -->
    <%- include('navbar') %>
        <%- include('notifications') %>
            <div class="container">
                <% if (myEvents.length> 0 || availableEvents.length > 0) { %>

                    <!-- My Events Section -->
                    <% if (myEvents.length> 0) { %>
                        <h2 class="section-title">My Events</h2>
                        <div class="my-events">
                            <div class="row">
                                <% myEvents.forEach(event=> { %>
                                    <div class="col-md-4">
                                        <div class="flip-card" onclick="this.classList.toggle('flipped');">
                                            <div class="flip-card-inner">
                                                <!-- Front side of the card -->
                                                <div class="flip-card-front">
                                                    <h5 class="card-title">
                                                        <%= event.name %>
                                                    </h5>
                                                    <div class="card-text">
                                                        <span class="label">Event Date:</span>
                                                        <span class="value">
                                                            <%= event.date %>
                                                        </span>
                                                    </div>
                                                    <div class="card-text">
                                                        <span class="label">Booked On:</span>
                                                        <span class="value">
                                                            <%= new Date(event.bookedOn).toLocaleDateString('en-IN', {
                                                                year: 'numeric' , month: 'long' , day: 'numeric' }) %>,
                                                                <%= new Date(event.bookedOn).toLocaleTimeString('en-IN',
                                                                    { hour: '2-digit' , minute: '2-digit' , hour12: true
                                                                    }) %>
                                                        </span>
                                                    </div>
                                                    <div class="card-text">
                                                        <span class="label">Hosted by:</span>
                                                        <span class="value">
                                                            <%= event.host %>
                                                        </span>
                                                    </div>
                                                    <p class="click-indicator">Click to see more<i
                                                            class="fas fa-arrow-right"></i></p>
                                                </div>
                                                <!-- Back side of the card -->
                                                <div class="flip-card-back">
                                                    <h5 class="card-title">Event Description</h5>
                                                    <p class="card-text">
                                                        <%= event.description %>
                                                    </p>
                                                    <button class="btn btn-book" onclick="openModal(event)">Cancel Event
                                                    </button>
                                                    <!-- Modal Structure -->
                                                    <div id="cancelModal" class="modal">
                                                        <div class="modal-content">
                                                            <span class="close-btn"
                                                                onclick="closeModal()">&times;</span>
                                                            <h3>Confirm Cancellation</h3>
                                                            <p>Are you sure you want to cancel
                                                                this event?</p>
                                                            <div class="modal-buttons">
                                                                <button class="btn-confirm"
                                                                    onclick="confirmCancel('<%= event.id %>',event)">Confirm</button>
                                                                <button class="btn-cancel"
                                                                    onclick="closeModal()">Cancel</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <% }) %>
                            </div>
                        </div>
                        <% } %>

                            <!-- Available Events Section -->
                            <% if (availableEvents.length> 0) { %>
                                <h2 class="section-title">Available Events</h2>
                                <div class="available-events">

                                    <div class="row">
                                        <% availableEvents.forEach(event=> { %>
                                            <div class="col-md-4">
                                                <div class="flip-card" onclick="this.classList.toggle('flipped');">
                                                    <div class="flip-card-inner">
                                                        <!-- Front side of the card -->
                                                        <div class="flip-card-front">
                                                            <h5 class="card-title">
                                                                <%= event.eventName %>
                                                            </h5>
                                                            <div class="card-text">
                                                                <span class="label">Event Date:</span>
                                                                <span class="value">
                                                                    <%= event.eventDate %>
                                                                </span>
                                                            </div>
                                                            <div class="card-text">
                                                                <span class="label">Hosted by:</span>
                                                                <span class="value">
                                                                    <%= event.centerName %>
                                                                </span>
                                                            </div>
                                                            <p class="click-indicator">Click to see more<i
                                                                    class="fas fa-arrow-right"></i></p>
                                                        </div>
                                                        <!-- Back side of the card -->
                                                        <div class="flip-card-back">
                                                            <h5 class="card-title">Event Description</h5>
                                                            <p class="card-text">
                                                                <%= event.eventDesc %>
                                                            </p>
                                                            <button class="btn btn-book"
                                                                onclick="bookEventfun('<%= event._id %>',event)">Book
                                                                Now</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <% }) %>
                                    </div>
                                </div>
                                <% } %>

                                    <% } else { %>
                                        <div class="no-events-message">
                                            <h2>No events are available at the moment. Please check back later.</h2>
                                        </div>
                                        <% } %>
            </div>

            <!-- Scripts -->
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
            <script>
                
                async function bookEventfun(id,event) {
                    event.stopPropagation();
                    await fetch(`/book/${id}/event`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                showNotification(data.message, true);
                                console.log(data.message);
                                setTimeout(() => {
                                    location.reload()
                                }, 2000);
                            } else {
                                showNotification(data.message, false);
                                console.log(data.message);
                                setTimeout(() => {
                                    location.reload()
                                }, 2000);
                            }
                        })
                        .catch(error => {
                            console.log('booking-event: ', error)
                            location.reload()
                        })
                }

               
                //***************************** Function to open the modal*********************************** //
                function openModal(event) {
                    event.stopPropagation(); // Prevent the card from flipping
                    document.getElementById('cancelModal').style.display = 'flex'; // Show the modal
                }

                // Function to close the modal
                function closeModal() {
                    document.getElementById('cancelModal').style.display = 'none'; // Hide the modal
                    selectedEventId = null; // Reset the selected event
                }

                // Function to confirm the cancellation
                async function confirmCancel(eventId) {
                    // if (!selectedEventId) return;
                    try {
                        const response = await fetch(`/cancel/${eventId}/event`, {
                            method: 'DELETE',
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        });
                        const data = await response.json();
                        if (data.success) {
                            showNotification(data.message,true);
                            location.reload(); // Reload the page after canceling the event
                        } else {
                            showNotification(data.message,false);
                        }
                    } catch (error) {
                        console.error('Error canceling event:', error);
                        showNotification('An error occurred. Please try again.', false);
                    } finally {
                    closeModal(); // Close the modal after the process
                    }
                }
                // **************************************************************************************************** //

            </script>
            <script src="/js/showNotification.js"></script>

</body>

</html>